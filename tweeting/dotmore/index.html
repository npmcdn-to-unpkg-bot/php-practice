<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>twitterを見てみる</title>
<script src="./jquery-1.9.1.min.js"></script>
</head>

<body>

<h1>もっと読む</h1>
<ul id="tweets">
</ul>

<p id="loading" style="display:none;">loading...</p>
<!-- <input type="button" id="more" value="もっと読む"> -->
<script>

$(function() {
/*
	var max_id;

	$('#more').click(function() {
		$('#loading').show();

		if ($('#tweets > li ').length) {
			max_id = $('#tweets > li:last').attr('id').replace(/^tweet_/, '');
		}
	console.log(max_id);
		$.get('more.php', {
			max_id: max_id
		}, function(rs) {
			$('#loading').hide();
			$(rs).appendTo('#tweets');
		});

	});
});
*/
	var max_id;

	$(window).scroll(function() {
		if ($(window).scrollTop() + $(window).height() == $(document).height()) {
			more();
		}
	});

	function more() {
		$("#loading").show();

		if ($('#tweets > li').length) {
			max_id = $('#tweets > li:last').attr('id').replace(/^tweet_/, '');
		}

	console.log(max_id);
		$.get('more.php', {
			max_id: max_id
		}, function(rs) {
			$('#loading').hide();
			$(rs).appendTo('#tweets').hide().fadeIn(800);
		});
	}

	more();

});

</script>


</body>
</html>
